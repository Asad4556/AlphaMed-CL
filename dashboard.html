<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Alpha-Med Clinical Lab - Report Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .section {
      margin-bottom: 30px;
    }
    label {
      display: block;
      margin: 5px 0 2px;
    }
    input, select {
      width: 100%;
      padding: 7px;
      margin-bottom: 10px;
    }
    .report {
      padding: 20px;
      border: 1px solid #000;
      margin-top: 30px;
      background-image: url('logo.png.png');
      background-repeat: repeat;
      background-position: center;
      background-size: 300px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }
    th, td {
      border: 1px solid #000;
      padding: 6px;
      text-align: center;
    }
    .report-header {
      text-align: center;
      margin-bottom: 10px;
    }
    .qr-code {
      float: left;
    }
    .logo {
      float: right;
      width: 100px;
    }
  </style>
</head>
<body>

  <div class="section">
    <h2>Patient Information</h2>
    <label>Name</label>
    <input id="name" type="text" required />
    <label>Father/Son Of/W/O</label>
    <input id="guardian" type="text" required />
    <label>CNIC</label>
    <input id="cnic" type="text" required />
    <label>Age</label>
    <input id="age" type="number" required />
    <label>Contact Number</label>
    <input id="contact" type="text" required />
    <label>Sample Number</label>
    <input id="sample" type="text" required />
    <label>Select Departments</label>
    <select id="departments" multiple size="10">
      <option>Hematology</option>
      <option>Serology</option>
      <option>Histopathology</option>
      <option>Microbiology</option>
      <option>Bio Chemistry</option>
      <option>Culture Tests</option>
      <option>Special Chemistry Test</option>
      <option>Molecular Biology</option>
      <option>Blood Banking</option>
    </select>
    <button onclick="generateReport()">Generate Report</button>
  </div>

  <div id="report" class="report" style="display:none;">
    <div class="report-header">
      <img src="logo.png.png" class="logo" />
      <div class="qr-code" id="qr"></div>
      <h2>Alpha-Med Clinical Lab</h2>
      <p>MRN #: <span id="mrn"></span></p>
    </div>
    <div>
      <strong>Name:</strong> <span id="r_name"></span><br />
      <strong>Guardian:</strong> <span id="r_guardian"></span><br />
      <strong>CNIC:</strong> <span id="r_cnic"></span><br />
      <strong>Age:</strong> <span id="r_age"></span><br />
      <strong>Contact:</strong> <span id="r_contact"></span><br />
      <strong>Sample #:</strong> <span id="r_sample"></span><br />
    </div>

    <div id="tests-container"></div>

    <p style="text-align:center; margin-top:30px;"><strong>Alpha-Med Clinical Lab</strong></p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrious/dist/qrious.min.js"></script>
  <script>
    const testDatabase = {
      "Hematology": ["CBC", "HB", "Platelet Count", "WBC"],
      "Serology": ["HbsAg", "HCV", "HIV", "Widal Test"],
      "Histopathology": ["Biopsy", "FNAC"],
      "Microbiology": ["Urine C/S", "Throat Swab C/S", "Sputum C/S"],
      "Bio Chemistry": ["Glucose", "Urea", "Creatinine", "Cholesterol"],
      "Culture Tests": ["Blood Culture", "Urine Culture"],
      "Special Chemistry Test": ["Vitamin D", "Troponin", "Electrolytes"],
      "Molecular Biology": ["PCR", "Covid PCR"],
      "Blood Banking": ["Blood Grouping", "Cross Match"]
    };

    function generateReport() {
      const name = document.getElementById("name").value;
      const guardian = document.getElementById("guardian").value;
      const cnic = document.getElementById("cnic").value;
      const age = document.getElementById("age").value;
      const contact = document.getElementById("contact").value;
      const sample = document.getElementById("sample").value;
      const departments = Array.from(document.getElementById("departments").selectedOptions).map(opt => opt.value);

      if (!name || !cnic || !age || !contact || !departments.length) {
        alert("Please fill all fields and select at least one department.");
        return;
      }

      // Fill Report
      document.getElementById("r_name").innerText = name;
      document.getElementById("r_guardian").innerText = guardian;
      document.getElementById("r_cnic").innerText = cnic;
      document.getElementById("r_age").innerText = age;
      document.getElementById("r_contact").innerText = contact;
      document.getElementById("r_sample").innerText = sample;
      const mrn = 'MRN' + Math.floor(Math.random() * 1000000);
      document.getElementById("mrn").innerText = mrn;

      // QR Code
      const qr = new QRious({
        element: document.getElementById("qr"),
        value: `${name}, ${cnic}, ${contact}, ${mrn}`,
        size: 100
      });

      // Test Table
      const container = document.getElementById("tests-container");
      container.innerHTML = "";
      departments.forEach(dep => {
        const tests = testDatabase[dep] || [];
        let table = `<h3>${dep}</h3><table><tr><th>Test</th><th>Normal Range</th><th>Result</th></tr>`;
        tests.forEach(test => {
          table += `<tr>
            <td>${test}</td>
            <td>--</td>
            <td><input placeholder="Enter Result" /></td>
          </tr>`;
        });
        table += "</table>";
        container.innerHTML += table;
      });

      document.getElementById("report").style.display = "block";
    }
  </script>
</body>
</html>
